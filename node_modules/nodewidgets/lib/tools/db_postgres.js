
var pg = require("pg");

var conString = "postgres://devuser:tbum91@pgdata/dev";

    
exports.query = function(strSql, params, fnOk, fnError) {
    
    console.log(conString);
    console.log(strSql);
    
    pg.connect(conString, function(err, client, done) {
        // client is a connection from pool...
        var checkForError = function(err) {
            if(!err) return false;
            console.error(err);
            done(client);
            return true;
        };
        
        if(checkForError(err)) return;
        client.query(strSql, params, function(err, results) {
            if(checkForError(err)) return;
            done(); // free client
            if (results) {
                console.log(results);
            }
            
            if (fnOk != null) {
                fnOk(results.rows);
            }
        });
    });
};


exports.queryRow = function(strSql, params, fnOk, fnError) {
  exports.query( strSql, params, function(res) {
    if (res.length > 0) {
      // use 1st result row
      fnOk(res[0]);
    }
    else {
      // give null
      fnOk(null);
    }
  }, fnError);
};


exports.queryValue = function(strSql, params, fnOk, fnError) {
  exports.queryRow( strSql, params, function(res) {
    fnOk(res.result);
  }, fnError);
};



exports.queryPage = function(strSql, offset, limit, params, fnOk, fnError) {
  var strSqlPaged = strSql + "   OFFSET " + offset + "   LIMIT " + limit;
  exports.query( strSqlPaged, params, fnOk, fnError );
};




