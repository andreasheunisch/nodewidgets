

exports.FormView = function(model) {

    var self = this;
    
    self.model = model;
  
    self.getServiceUrl = function() {
		return self.model.url;
	};
  
    self.getColumnInfo = function ( queryoptions ) {
        var columns = [];
        for (var i = 0; i < self.model.columnDefs.length; i++) {
            columns.push({
                "fldid": self.model.columnDefs[i].fldid,
                "caption": self.model.columnDefs[i].caption || self.model.columnDefs[i].fldid,
                "type": self.model.columnDefs[i].type || 'string',
                "format": self.model.columnDefs[i].format,
                "prefix": self.model.columnDefs[i].prefix,
                "suffix": self.model.columnDefs[i].suffix
            });
        }
        return columns;
    };
  
    
    self.registerExpressAppRoutes = function( app ) {
    
	    app.get( self.model.url+'/metadata/json', function(req, res) {
          var queryoptions = {};
          res.writeHead(200, {'content-type': 'text/json' });
          var jsonData = JSON.stringify({
              "options": queryoptions,
              "columns": self.getColumnInfo(queryoptions),
          });
          res.write( jsonData );
          res.end('\n');
      });
        
	    app.get( self.model.url+'/formdata/json', function(req, res) {
          var queryoptions = {};
          self.model.getData( queryoptions, function(result) {
            res.writeHead(200, {'content-type': 'text/json' });
            var jsonData = JSON.stringify({
                "options": queryoptions,
                "meta": { columns: self.getColumnInfo(queryoptions) },
                "data": result
            });
            res.write( jsonData );
            res.end('\n');
        });
	    });
    };

  
};










